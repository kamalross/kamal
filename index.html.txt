<!-- CALC -->
<div class="modal-overlay" id="modal-calc"><div class="modal-box">
  <div class="modal-header">
    <span class="modal-title"><svg viewBox="0 0 24 24"><use href="#icon-calculator"/></svg> Scientific Calculator</span>
    <button class="modal-close" onclick="closeModal('calc')"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><use href="#icon-close"/></svg></button>
  </div>
  <div class="modal-content">
    <div class="calc-wrap">
      <div class="calc-display"><div class="calc-expr" id="calcExpr">&nbsp;</div><div class="calc-num" id="calcDisplay">0</div></div>
      <div class="calc-grid">
        <button class="calc-btn clr" onclick="calcClear()">C</button><button class="calc-btn op" onclick="calcInput('(')">(</button><button class="calc-btn op" onclick="calcInput(')')">)</button><button class="calc-btn op" onclick="calcInput('/')">&#247;</button>
        <button class="calc-btn" onclick="calcInput('Math.sin(')">sin</button><button class="calc-btn" onclick="calcInput('Math.cos(')">cos</button><button class="calc-btn" onclick="calcInput('Math.tan(')">tan</button><button class="calc-btn op" onclick="calcInput('*')">&#215;</button>
        <button class="calc-btn" onclick="calcInput('7')">7</button><button class="calc-btn" onclick="calcInput('8')">8</button><button class="calc-btn" onclick="calcInput('9')">9</button><button class="calc-btn op" onclick="calcInput('-')">-</button>
        <button class="calc-btn" onclick="calcInput('4')">4</button><button class="calc-btn" onclick="calcInput('5')">5</button><button class="calc-btn" onclick="calcInput('6')">6</button><button class="calc-btn op" onclick="calcInput('+')">+</button>
        <button class="calc-btn" onclick="calcInput('1')">1</button><button class="calc-btn" onclick="calcInput('2')">2</button><button class="calc-btn" onclick="calcInput('3')">3</button><button class="calc-btn" onclick="calcInput('Math.sqrt(')">&#8730;</button>
        <button class="calc-btn" onclick="calcInput('Math.PI')">&#960;</button><button class="calc-btn" onclick="calcInput('0')">0</button><button class="calc-btn" onclick="calcInput('.')">.</button><button class="calc-btn" onclick="calcInput('**')">x<sup>n</sup></button>
        <button class="calc-btn" onclick="calcInput('Math.log(')">ln</button><button class="calc-btn" onclick="calcInput('Math.log10(')">log</button><button class="calc-btn clr" onclick="calcBackspace()">&#9003;</button>
        <button class="calc-btn eq" onclick="calcEquals()">=</button>
      </div>
    </div>
  </div>
</div></div>

<!-- CHESS -->
<div class="modal-overlay" id="modal-chess"><div class="modal-box">
  <div class="modal-header">
    <span class="modal-title"><svg viewBox="0 0 24 24"><use href="#icon-chess"/></svg> Chess Engine &mdash; Play vs AI</span>
    <button class="modal-close" onclick="closeModal('chess')"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><use href="#icon-close"/></svg></button>
  </div>
  <div class="modal-content">
    <div class="chess-info">
      <div class="chess-turn" id="chessTurn">&#9812; WHITE'S TURN</div>
      <button class="calc-btn clr" style="padding:8px 16px;font-size:12px;letter-spacing:.1em;" onclick="initChess()">New Game</button>
    </div>
    <div class="chess-board" id="chessBoard"></div>
    <div class="chess-msg" id="chessMsg">You play White &middot; Click a piece, then click destination</div>
  </div>
</div></div>

<!-- NETWORK -->
<div class="modal-overlay" id="modal-net"><div class="modal-box">
  <div class="modal-header">
    <span class="modal-title"><svg viewBox="0 0 24 24"><use href="#icon-network"/></svg> Network Scanner Simulator</span>
    <button class="modal-close" onclick="closeModal('net')"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><use href="#icon-close"/></svg></button>
</div>
  <div class="modal-content">
    <div class="net-wrap">
      <div class="net-input-row"><input class="net-input" id="netTarget" value="192.168.1.0/24" placeholder="Target IP range or domain"/><button class="net-scan-btn" onclick="startScan()">&#9654; SCAN</button></div>
      <div class="net-terminal" id="netTerminal"><div class="net-line dim">// Network Scanner v2.4 — by Kamal Belakehal</div><div class="net-line dim">// Enter a target and press SCAN</div></div>
      <div class="net-hosts" id="netHosts"></div>
    </div>
  </div>
</div></div>

<!-- CIPHER -->
<div class="modal-overlay" id="modal-cipher"><div class="modal-box">
  <div class="modal-header">
    <span class="modal-title"><svg viewBox="0 0 24 24"><use href="#icon-cipher"/></svg> Cipher &amp; Encryption Tool</span>
    <button class="modal-close" onclick="closeModal('cipher')"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><use href="#icon-close"/></svg></button>
  </div>
  <div class="modal-content">
    <div class="cipher-tabs"><button class="cipher-tab active" onclick="setCipherTab('encrypt',this)">&#128272; Encrypt</button><button class="cipher-tab" onclick="setCipherTab('decrypt',this)">&#128273; Decrypt</button></div>
    <textarea class="cipher-textarea" id="cipherInput" placeholder="Enter your message here..."></textarea>
    <div class="cipher-row">
      <select class="cipher-select" id="cipherMethod"><option value="caesar">Caesar Cipher</option><option value="vigenere">Vigenère Cipher</option><option value="rot13">ROT13</option><option value="base64">Base64</option><option value="reverse">Reverse</option></select>
      <input class="cipher-key-input" id="cipherKey" placeholder="Key/Shift" value="13"/>
      <button class="cipher-action-btn" onclick="runCipher()">&#9654; RUN</button>
    </div>
    <div class="pw-tips-title" style="margin-bottom:8px;">Output</div>
    <div class="cipher-output" id="cipherOutput">Result will appear here...</div>
  </div>
</div></div>

<!-- GEO -->
<div class="modal-overlay" id="modal-geo"><div class="modal-box">
  <div class="modal-header">
    <span class="modal-title"><svg viewBox="0 0 24 24"><use href="#icon-globe"/></svg> Geopolitics Power Dashboard</span>
    <button class="modal-close" onclick="closeModal('geo')"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><use href="#icon-close"/></svg></button>
  </div>
  <div class="modal-content" style="font-family:'Share Tech Mono','Courier New',monospace;">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px;">
      <div style="background:var(--bg3);border:1px solid var(--border);padding:16px;border-left:2px solid var(--gold);"><div style="font-size:10px;color:var(--gold);letter-spacing:.2em;margin-bottom:8px;">ACTIVE CONFLICTS</div><div style="font-size:32px;color:#cc2200;font-weight:700;">34</div><div style="font-size:10px;color:var(--text-dim);margin-top:4px;">+3 from last month</div></div>
      <div style="background:var(--bg3);border:1px solid var(--border);padding:16px;border-left:2px solid var(--gold);"><div style="font-size:10px;color:var(--gold);letter-spacing:.2em;margin-bottom:8px;">NATO MEMBERS</div><div style="font-size:32px;color:var(--gold);font-weight:700;">32</div><div style="font-size:10px;color:var(--text-dim);margin-top:4px;">Since 2024</div></div>
      <div style="background:var(--bg3);border:1px solid var(--border);padding:16px;border-left:2px solid var(--gold);"><div style="font-size:10px;color:var(--gold);letter-spacing:.2em;margin-bottom:8px;">NUCLEAR STATES</div><div style="font-size:32px;color:#ff9800;font-weight:700;">9</div><div style="font-size:10px;color:var(--text-dim);margin-top:4px;">Declared + Undeclared</div></div>
      <div style="background:var(--bg3);border:1px solid var(--border);padding:16px;border-left:2px solid var(--gold);"><div style="font-size:10px;color:var(--gold);letter-spacing:.2em;margin-bottom:8px;">UN SANCTIONS</div><div style="font-size:32px;color:var(--gold-light);font-weight:700;">18</div><div
style="font-size:10px;color:var(--text-dim);margin-top:4px;">Active regimes</div></div>
    </div>
    <div style="background:var(--bg3);border:1px solid var(--border);padding:16px;margin-bottom:16px;"><div style="font-size:10px;color:var(--gold);letter-spacing:.2em;margin-bottom:14px;">GLOBAL POWER INDEX 2025</div><div id="geoBars"></div></div>
    <div style="background:var(--bg3);border:1px solid var(--border);padding:16px;"><div style="font-size:10px;color:var(--gold);letter-spacing:.2em;margin-bottom:10px;">HOT ZONES</div><div id="hotZones"></div></div>
  </div>
</div></div>

<script>
// CURSOR
const cursor=document.getElementById('cursor'),trail=document.getElementById('cursorTrail');
let mx=0,my=0,tx=0,ty=0;
document.addEventListener('mousemove',e=>{mx=e.clientX;my=e.clientY;cursor.style.left=mx+'px';cursor.style.top=my+'px';});
(function loop(){tx+=(mx-tx)*.12;ty+=(my-ty)*.12;trail.style.left=tx+'px';trail.style.top=ty+'px';requestAnimationFrame(loop);})();
document.addEventListener('mousedown',()=>{cursor.style.transform='translate(-50%,-50%) scale(1.8)';cursor.style.background='rgba(201,168,76,0.3)';});
document.addEventListener('mouseup',()=>{cursor.style.transform='translate(-50%,-50%) scale(1)';cursor.style.background='transparent';});

// REVEAL
const revEls=document.querySelectorAll('.reveal');
const revObs=new IntersectionObserver(entries=>entries.forEach(e=>{if(e.isIntersecting)e.target.classList.add('visible');}),{threshold:.05});
revEls.forEach(el=>revObs.observe(el));
setTimeout(()=>revEls.forEach(el=>{if(el.getBoundingClientRect().top<window.innerHeight)el.classList.add('visible');}),50);

// SKILL BARS
const bars=document.querySelectorAll('.skill-bar');
const barObs=new IntersectionObserver(entries=>entries.forEach(e=>{if(e.isIntersecting){e.target.style.width=e.target.dataset.width+'%';barObs.unobserve(e.target);}}),{threshold:.1});
bars.forEach(b=>barObs.observe(b));

// RIPPLE
document.querySelectorAll('.btn-primary,.btn-outline').forEach(btn=>{btn.addEventListener('click',function(e){const r=document.createElement('span'),rect=this.getBoundingClientRect(),sz=Math.max(rect.width,rect.height)*2;r.style.cssText=position:absolute;border-radius:50%;width:${sz}px;height:${sz}px;left:${e.clientX-rect.left-sz/2}px;top:${e.clientY-rect.top-sz/2}px;background:rgba(255,255,255,.2);transform:scale(0);animation:rippleAnim .6s linear forwards;pointer-events:none;z-index:10;;this.appendChild(r);setTimeout(()=>r.remove(),700);});});

// MAGNETIC SOCIAL
document.querySelectorAll('.social-link').forEach(el=>{el.addEventListener('mousemove',function(e){const r=this.getBoundingClientRect(),x=e.clientX-r.left-r.width/2,y=e.clientY-r.top-r.height/2;this.style.transform=translateY(-8px) scale(1.05) translate(${x*.08}px,${y*.08}px);});el.addEventListener('mouseleave',function(){this.style.transform='';});});

// NAV
const navLinks=document.querySelectorAll('nav a'),sects=document.querySelectorAll('section[id]');
window.addEventListener('scroll',()=>{let cur='';sects.forEach(s=>{if(window.scrollY>=s.offsetTop-200)cur=s.id;});navLinks.forEach(a=>{a.style.color=a.getAttribute('href')==='#'+cur?'var(--gold)':'';});});

// MODAL
function openModal(id){document.getElementById('modal-'+id).classList.add('open');document.body.style.overflow='hidden';if(id==='chess')initChess();if(id==='geo')initGeo();}
function closeModal(id){document.getElementById('modal-'+id).classList.remove('open');document.body.style.overflow='';}
document.querySelectorAll('.modal-overlay').forEach(m=>{m.addEventListener('click',function(e){if(e.target===this){this.classList.remove('open');document.body.style.overflow='';}});});
document.addEventListener('keydown',e=>{if(e.key==='Escape')document.querySelectorAll('.modal-overlay.open').forEach(m=>{m.classList.remove('open');document.body.style.overflow='';});});
// -- PASSWORD STRENGTH
let pwVisible=false;
function analyzePW(){
  const pw=document.getElementById('pwInput').value;
  const label=document.getElementById('pwLabel'),meter=document.getElementById('pwMeter'),entEl=document.getElementById('pwEntropy'),crackEl=document.getElementById('pwCrack'),poolEl=document.getElementById('pwPool'),lenEl=document.getElementById('pwLen'),tipsEl=document.getElementById('pwTips');
  if(!pw){label.textContent='— Enter a password —';label.style.color='var(--text-dim)';meter.style.width='0';entEl.textContent=crackEl.textContent=poolEl.textContent=lenEl.textContent='—';tipsEl.innerHTML='';return;}
  let pool=0;
  const hasLower=/[a-z]/.test(pw),hasUpper=/[A-Z]/.test(pw),hasNum=/[0-9]/.test(pw),hasSymbol=/[^a-zA-Z0-9]/.test(pw);
  if(hasLower)pool+=26;if(hasUpper)pool+=26;if(hasNum)pool+=10;if(hasSymbol)pool+=32;
  const entropy=Math.round(pw.length*Math.log2(pool||1));
  const seconds=Math.pow(pool||1,pw.length)/1e12;
  let crackTime=seconds<60?'< 1 min':seconds<3600?Math.round(seconds/60)+' min':seconds<86400?Math.round(seconds/3600)+' hrs':seconds<31536000?Math.round(seconds/86400)+' days':seconds<3153600000?Math.round(seconds/31536000)+' years':'Centuries+';
  let score=0;
  if(pw.length>=8)score++;if(pw.length>=12)score++;if(pw.length>=16)score++;
  if(hasLower)score++;if(hasUpper)score++;if(hasNum)score++;if(hasSymbol)score+=2;
  const common=['password','123456','qwerty','abc123','letmein','admin','welcome','iloveyou'];
  if(common.some(c=>pw.toLowerCase().includes(c)))score-=3;
  score=Math.max(0,Math.min(score,8));
  const pct=Math.round(score/8*100);
  let color,text;
  if(score<=2){color='#cc2200';text='CRITICAL — Extremely Weak';}
  else if(score<=4){color='#ff9800';text='WEAK — Easy to Crack';}
  else if(score<=6){color='#e8c97a';text='MODERATE — Acceptable';}
  else{color='#4caf50';text='STRONG — Well Secured';}
  meter.style.width=pct+'%';meter.style.background=color;
  label.textContent=text;label.style.color=color;
  entEl.textContent=entropy+' bits';crackEl.textContent=crackTime;poolEl.textContent=pool+' chars';lenEl.textContent=pw.length;
  tipsEl.innerHTML=[{pass:pw.length>=12,text:'At least 12 characters'},{pass:hasUpper,text:'Contains uppercase letters'},{pass:hasLower,text:'Contains lowercase letters'},{pass:hasNum,text:'Contains numbers'},{pass:hasSymbol,text:'Contains special symbols'},{pass:!common.some(c=>pw.toLowerCase().includes(c)),text:'No common words detected'},{pass:entropy>=50,text:'High entropy (50+ bits)'}].map(t=><div class="pw-tip ${t.pass?'pass':'fail'}">${t.pass?'&#10003;':'&#10007;'} ${t.text}</div>).join('');
}
function togglePW(){
  const i=document.getElementById('pwInput');
  pwVisible=!pwVisible;
  i.type=pwVisible?'text':'password';
  document.getElementById('pwEyeIcon').innerHTML=pwVisible?'<use href="#icon-eye-off"/>':'<use href="#icon-eye"/>';
}

// -- CALCULATOR
let calcExpr='';
function calcInput(v){calcExpr+=v;document.getElementById('calcDisplay').textContent=calcExpr||'0';document.getElementById('calcExpr').textContent='';}
function calcClear(){calcExpr='';document.getElementById('calcDisplay').textContent='0';document.getElementById('calcExpr').textContent='';}
function calcBackspace(){calcExpr=calcExpr.slice(0,-1);document.getElementById('calcDisplay').textContent=calcExpr||'0';}
function calcEquals(){
  try{
    let expr=calcExpr.replace(/Math\.sin\(([^)]+)\)/g,(m,a)=>Math.sin(${a}*Math.PI/180)).replace(/Math\.cos\(([^)]+)\)/g,(m,a)=>Math.cos(${a}*Math.PI/180)).replace(/Math\.tan\(([^)]+)\)/g,(m,a)=>Math.tan(${a}*Math.PI/180));
    const result=Function('"use strict";return ('+expr+')')();
    document.getElementById('calcExpr').textContent=calcExpr+' =';
    const display=isNaN(result)||!isFinite(result)?'Error':+parseFloat(result.toFixed(10));
document.getElementById('calcDisplay').textContent=display;
    calcExpr=display==='Error'?'':String(display);
  }catch{document.getElementById('calcDisplay').textContent='Error';calcExpr='';}
}
document.addEventListener('keydown',e=>{if(!document.getElementById('modal-calc').classList.contains('open'))return;const k=e.key;if('0123456789.+-*/()'.includes(k)){e.preventDefault();calcInput(k);}else if(k==='Enter'){e.preventDefault();calcEquals();}else if(k==='Backspace'){e.preventDefault();calcBackspace();}});

// -- CHESS
const PIECES={K:'?',Q:'?',R:'?',B:'?',N:'?',P:'?',k:'?',q:'?',r:'?',b:'?',n:'?',p:'?'};
let board=[],selected=null,turn='w',gameOver=false,lastMove=null;
function initBoard(){return['rnbqkbnr','pppppppp','........','........','........','........','PPPPPPPP','RNBQKBNR'].map(r=>[...r]);}
function initChess(){board=initBoard();selected=null;turn='w';gameOver=false;lastMove=null;document.getElementById('chessTurn').textContent='? WHITE\'S TURN';document.getElementById('chessMsg').textContent='You play White · Click a piece, then click destination';renderBoard();}
function isW(p){return p>='A'&&p<='Z';}function isB(p){return p>='a'&&p<='z';}function inB(r,c){return r>=0&&r<8&&c>=0&&c<8;}
function getMoves(r,c){
  const p=board[r][c];if(p==='.')return[];const w=isW(p),t=p.toLowerCase(),moves=[];
  const slide=ds=>ds.forEach(([dr,dc])=>{let nr=r+dr,nc=c+dc;while(inB(nr,nc)){const tp=board[nr][nc];if(tp==='.')moves.push([nr,nc]);else{if(w?isB(tp):isW(tp))moves.push([nr,nc]);break;}nr+=dr;nc+=dc;}});
  if(t==='r')slide([[0,1],[0,-1],[1,0],[-1,0]]);
  else if(t==='b')slide([[1,1],[1,-1],[-1,1],[-1,-1]]);
  else if(t==='q')slide([[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]]);
  else if(t==='n')[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(([dr,dc])=>{const nr=r+dr,nc=c+dc;if(inB(nr,nc)){const tp=board[nr][nc];if(tp==='.'||(w?isB(tp):isW(tp)))moves.push([nr,nc]);}});
  else if(t==='k')[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].forEach(([dr,dc])=>{const nr=r+dr,nc=c+dc;if(inB(nr,nc)){const tp=board[nr][nc];if(tp==='.'||(w?isB(tp):isW(tp)))moves.push([nr,nc]);}});
  else if(t==='p'){const d=w?-1:1,s=w?6:1;if(inB(r+d,c)&&board[r+d][c]==='.')moves.push([r+d,c]);if(r===s&&board[r+d][c]==='.'&&board[r+2*d][c]==='.')moves.push([r+2*d,c]);[-1,1].forEach(dc=>{if(inB(r+d,c+dc)){const tp=board[r+d][c+dc];if(w?isB(tp):isW(tp))moves.push([r+d,c+dc]);}});}
  return moves;
}
function renderBoard(){
  const el=document.getElementById('chessBoard');el.innerHTML='';
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    const cell=document.createElement('div');
    cell.className='chess-cell '+((r+c)%2===0?'light':'dark');
    if(selected&&selected[0]===r&&selected[1]===c)cell.classList.add('selected');
    if(lastMove&&((lastMove.fr===r&&lastMove.fc===c)||(lastMove.tr===r&&lastMove.tc===c)))cell.classList.add('last-move');
    if(selected&&getMoves(selected[0],selected[1]).some(m=>m[0]===r&&m[1]===c))cell.classList.add('possible');
    const p=board[r][c];if(p!=='.')cell.textContent=PIECES[p]||p;
    cell.onclick=()=>handleClick(r,c);el.appendChild(cell);
  }
}
function handleClick(r,c){
  if(gameOver)return;const p=board[r][c];
  if(selected){
    const moves=getMoves(selected[0],selected[1]),valid=moves.find(m=>m[0]===r&&m[1]===c);
    if(valid){
      const cap=board[r][c];lastMove={fr:selected[0],fc:selected[1],tr:r,tc:c};
      board[r][c]=board[selected[0]][selected[1]];board[selected[0]][selected[1]]='.';
      if(board[r][c]==='P'&&r===0)board[r][c]='Q';if(board[r][c]==='p'&&r===7)board[r][c]='q';
      selected=null;turn=turn==='w'?'b':'w';
      document.getElementById('chessTurn').textContent=turn==='w'?'? WHITE\'S TURN':'? BLACK\'S TURN';
      renderBoard();
      if(!board.some(row=>row.includes(turn==='w'?'k':'K'))){gameOver=true;document.getElementById('chessMsg').textContent=(turn==='b'?'White':'Black')+' wins! Checkmate!';document.getElementById('chessTurn').textContent='GAME OVER';}
else{document.getElementById('chessMsg').textContent=cap!=='.'?'Piece captured!':'Move made.';if(turn==='b')setTimeout(aiMove,500);}
    }else{selected=(p!=='.'&&(turn==='w'?isW(p):isB(p)))?[r,c]:null;renderBoard();}
  }else{if(p!=='.'&&(turn==='w'?isW(p):isB(p)))selected=[r,c];renderBoard();}
}
function aiMove(){
  if(gameOver)return;let best=null,bScore=-Infinity;
  for(let r=0;r<8;r++)for(let c=0;c<8;c++)if(board[r][c]!=='.'&&isB(board[r][c]))getMoves(r,c).forEach(([nr,nc])=>{const v=({q:9,r:5,b:3,n:3,p:1,k:100}[board[nr][nc]?.toLowerCase()]||0)+Math.random()*.4;if(v>bScore){bScore=v;best={r,c,nr,nc};}});
  if(best){lastMove={fr:best.r,fc:best.c,tr:best.nr,tc:best.nc};board[best.nr][best.nc]=board[best.r][best.c];board[best.r][best.c]='.';if(board[best.nr][best.nc]==='p'&&best.nr===7)board[best.nr][best.nc]='q';turn='w';document.getElementById('chessTurn').textContent='? WHITE\'S TURN';if(!board.some(row=>row.includes('K'))){gameOver=true;document.getElementById('chessMsg').textContent='Black wins!';document.getElementById('chessTurn').textContent='GAME OVER';}else document.getElementById('chessMsg').textContent='AI moved · Your turn';renderBoard();}
}

// -- NETWORK SCANNER
let scanning=false;
function startScan(){
  if(scanning)return;scanning=true;
  const term=document.getElementById('netTerminal'),hosts=document.getElementById('netHosts'),target=document.getElementById('netTarget').value||'192.168.1.0/24';
  term.innerHTML='';hosts.innerHTML='';
  const log=(msg,cls)=>{term.innerHTML+=<div class="net-line ${cls||''}">${msg}</div>;term.scrollTop=term.scrollHeight;};
  const delay=ms=>new Promise(r=>setTimeout(r,ms));
  const portNames={22:'SSH',80:'HTTP',443:'HTTPS',3306:'MySQL',8080:'HTTP-Alt',21:'FTP',25:'SMTP',53:'DNS',3389:'RDP',27017:'MongoDB'};
  const ports=Object.keys(portNames).map(Number);
  (async()=>{
    log(<span style="color:var(--gold)">root@kali</span>:<span style="color:#4caf50">~/tools</span># nmap -sV -T4 ${target},'cmd');
    await delay(400);log('Starting Nmap 7.94SVN — https://nmap.org','dim');
    await delay(300);log(Initiating SYN Stealth Scan at ${new Date().toLocaleTimeString()},'dim');
    await delay(500);log('Scanning '+target+' ['+Math.floor(Math.random()*100+150)+' hosts]...','info');
    const numHosts=Math.floor(Math.random()*5)+4,hostNums=new Set();
    while(hostNums.size<numHosts)hostNums.add(Math.floor(Math.random()*50)+1);
    for(const n of hostNums){
      const ip='192.168.1.'+n;await delay(Math.random()*400+200);
      log(Host ${ip} is up (${(Math.random()*.5+.01).toFixed(2)}ms latency),'info');
      const openPorts=ports.filter(()=>Math.random()>.55).slice(0,4);
      openPorts.forEach(p=>log(  ${p}/tcp   open   ${portNames[p]},'dim'));
      hosts.innerHTML+=<div class="net-host"><div class="net-host-ip">&#9658; ${ip}</div><div class="net-host-ports">Open: ${openPorts.map(p=>portNames[p]).join(', ')||'none'}</div></div>;
    }
    await delay(400);log('-------------------------------------','dim');
    log(Nmap done: ${numHosts} hosts up — Raw packets: ${Math.floor(Math.random()*500)+500},'info');
    log('Scan complete.','cmd');scanning=false;
  })();
}

// -- CIPHER
let cipherMode='encrypt';
function setCipherTab(m,btn){cipherMode=m;document.querySelectorAll('.cipher-tab').forEach(t=>t.classList.remove('active'));btn.classList.add('active');}
function runCipher(){
  const text=document.getElementById('cipherInput').value,method=document.getElementById('cipherMethod').value,key=document.getElementById('cipherKey').value,out=document.getElementById('cipherOutput');
  if(!text){out.textContent='Enter a message first.';return;}
  let result='';
  if(method==='rot13')result=[...text].map(c=>{const a=c.charCodeAt(0);if(a>=65&&a<=90)return String.fromCharCode((a-65+13)%26+65);if(a>=97&&a<=122)return String.fromCharCode((a-97+13)%26+97);return c;}).join('');
else if(method==='base64'){try{result=cipherMode==='encrypt'?btoa(unescape(encodeURIComponent(text))):decodeURIComponent(escape(atob(text)));}catch{result='Invalid Base64 for decryption';}}
  else if(method==='reverse')result=[...text].reverse().join('');
  else if(method==='caesar'){const shift=((parseInt(key)||13)%26)*(cipherMode==='decrypt'?-1:1);result=[...text].map(c=>{const a=c.charCodeAt(0);if(a>=65&&a<=90)return String.fromCharCode((a-65+shift+26)%26+65);if(a>=97&&a<=122)return String.fromCharCode((a-97+shift+26)%26+97);return c;}).join('');}
  else if(method==='vigenere'){const k=(key||'KEY').toUpperCase().replace(/[^A-Z]/g,'');let ki=0;result=[...text].map(c=>{const a=c.charCodeAt(0);if(a>=65&&a<=90){const s=k.charCodeAt(ki%k.length)-65;ki++;return String.fromCharCode((a-65+(cipherMode==='encrypt'?s:26-s))%26+65);}if(a>=97&&a<=122){const s=k.charCodeAt(ki%k.length)-65;ki++;return String.fromCharCode((a-97+(cipherMode==='encrypt'?s:26-s))%26+97);}return c;}).join('');}
  out.textContent=result;
}

// -- GEO
function initGeo(){
  const countries=[{name:'United States',score:97,color:'#c9a84c'},{name:'China',score:92,color:'#cc2200'},{name:'Russia',score:81,color:'#888'},{name:'European Union',score:78,color:'#4caf50'},{name:'India',score:71,color:'#ff9800'},{name:'United Kingdom',score:65,color:'#4fc3f7'}];
  document.getElementById('geoBars').innerHTML=countries.map(c=><div style="margin-bottom:14px;"><div style="display:flex;justify-content:space-between;margin-bottom:5px;font-size:11px;"><span style="color:var(--text)">${c.name}</span><span style="color:${c.color};font-weight:700;">${c.score}/100</span></div><div style="height:4px;background:rgba(255,255,255,.07);"><div style="height:100%;width:${c.score}%;background:${c.color};transition:width 1.2s ease;"></div></div></div>).join('');
  const zones=[{r:'Eastern Europe',l:'HIGH',c:'#cc2200'},{r:'Middle East',l:'HIGH',c:'#cc2200'},{r:'South China Sea',l:'ELEVATED',c:'#ff9800'},{r:'West Africa — Sahel',l:'ELEVATED',c:'#ff9800'},{r:'Korean Peninsula',l:'MODERATE',c:'#e8c97a'},{r:'Taiwan Strait',l:'HIGH',c:'#cc2200'}];
  document.getElementById('hotZones').innerHTML=zones.map(z=><div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);font-size:12px;"><span style="color:var(--text)">${z.r}</span><span style="color:${z.c};font-weight:700;">${z.l}</span></div>).join('');
}
</script>
</body>
</html>
